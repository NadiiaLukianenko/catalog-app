<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Login</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js">
    </script>
    <script src="https://apis.google.com/js/client:platform.js?onload=start" async defer>
    </script>
</head>
<body>
<div id="signinButton">
    <span class="g-signin"
        data-scope="https://www.googleapis.com/auth/plus.login"
        data-clientid="870188233272-hefvnkou90jeni3tuhf9dims8adok9v4.apps.googleusercontent.com"
        data-redirecturis="postmessage"
        data-accesstype="offline"
        data-cookiepolicy="single_host_origin"
        data-callback="signInCallback">
    </span>
</div>
<!--/gconnect?state=' + state -->
<div id="result"></div>
<script>
var state = '{{ state }}';
function signInCallback(authResult)
{
    if (authResult['code'])
    {
    $('#singinButton').attr('style','display: none');
    $.ajax(
    {
        type: 'POST',
        url: '/gconnect?state=' + state,
        processData: false,
        contentType: 'application/octet-stream; charset=utf-8',
        data: authResult['code'],
        success: function(result) {
        if (result) {
            $('#result').html('Login successful!</br> + result + </br> Redirecting...');
            setTimeout(function() {window.location.href = "/";}, 400);
        } else if (authResult['error']) {
            console.log('There was an error: ' + authResult['error']);
        } else {
        $('#result').html('Failed to make a server-side call. Check your configuration and console.');
        }
        }
    });

   }
}
</script>
</body>
</html>